-- CREATING TABLES:
-- CREATING PRODUCT DETAILS TABLE:
CREATE TABLE APP.PRODUCTDETAILS(
PRODUCT_ID INT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
PRODUCTNAME VARCHAR(255),
DESCRIPTION VARCHAR(255),
CATEGORY CHAR(6),
QUANTITY VARCHAR(255),
PRICE VARCHAR(255),
CUSTOMER_ID INT);

-- CREATING CUSTOMER DETAILS TABLE:
CREATE TABLE APP.CUSTOMERDETAILS(
CUSTOMER_ID INT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
FIRSTNAME VARCHAR(255),
LASTNAME VARCHAR(255),
GENDER CHAR(6),
DOB VARCHAR(255),
USERNAME VARCHAR(255),
PASSWORD VARCHAR(255),
ORDER_ID INT,
ORDER_NUMBER INT,
PRODUCT_ID INT);

-- CREATING ORDER DETAILS TABLE:
CREATE TABLE APP.ORDERDETAILS(
ORDER_ID INT GENERATED ALWAYS AS IDENTITY,
ORDER_NUMBER INT,
CONSTRAINT ORDER_ID PRIMARY KEY (ORDER_ID,ORDER_NUMBER),
CUSTOMER_ID INT,
PRODUCT_ID INT,
PRODUCTNAME VARCHAR(255),
QUANTITY INT,
PRICE INT);

-- INDEXING AND REFERENCING:
-- CUSTOMER DETAILS TABLE:
ALTER TABLE APP.CUSTOMERDETAILS ADD FOREIGN KEY (PRODUCT_ID) REFERENCES APP.PRODUCTDETAILS(PRODUCT_ID);
ALTER TABLE APP.CUSTOMERDETAILS ADD FOREIGN KEY (ORDER_ID) REFERENCES APP.ORDERDETAILS(ORDER_ID);
INSERT INTO APP.PRODUCTDETAILS (CUSTOMER_ID)
SELECT CUSTOMER_ID FROM APP.CUSTOMERDETAILS;
CREATE INDEX CUSTOMER_ID ON APP.PRODUCTDETAILS (CUSTOMER_ID);

-- PRODUCT DETIALS TABLE:
ALTER TABLE APP.PRODUCTDETAILS ADD FOREIGN KEY (CUSTOMER_ID) REFERENCES APP.CUSTOMERDETAILS(CUSTOMER_ID);
INSERT INTO APP.CUSTOMERDETAILS (ORDER_ID, ORDER_NUMBER)
SELECT ORDER_ID, ORDER_NUMBER FROM APP.ORDERDETAILS;
INSERT INTO APP.CUSTOMERDETAILS (PRODUCT_ID)
SELECT PRODUCT_ID FROM APP.PRODUCTDETAILS;
CREATE INDEX ORDER_ID ON APP.CUSTOMERDETAILS (ORDER_ID);
CREATE INDEX ORDER_NUMBER ON APP.CUSTOMERDETAILS (ORDER_NUMBER);
CREATE INDEX PRODUCT_ID ON APP.CUSTOMERDETAILS (PRODUCT_ID);

-- ORDER DETAILS TABLE:
ALTER TABLE APP.ORDERDETAILS ADD FOREIGN KEY (CUSTOMER_ID) REFERENCES APP.CUSTOMERDETAILS(CUSTOMER_ID);
ALTER TABLE APP.ORDERDETAILS ADD FOREIGN KEY (PRODUCT_ID) REFERENCES APP.PRODUCTDETAILS(PRODUCT_ID);
CREATE INDEX PRODUCT_ID ON APP.ORDERDETAILS (ORDER_ID);
CREATE INDEX ORDER_NUMBER ON APP.ORDERDETAILS (ORDER_NUMBER);
CREATE INDEX CUSTOMER_ID ON APP.ORDERDETAILS (CUSTOMER_ID);
INSERT INTO APP.ORDERDETAILS (CUSTOMER_ID)
SELECT CUSTOMER_ID FROM APP.CUSTOMERDETAILS;
INSERT INTO APP.ORDERDETAILS (PRODUCT_ID)
SELECT PRODUCT_ID FROM APP.PRODUCTDETAILS;